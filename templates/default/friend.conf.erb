Listen 80
Listen 443
<VirtualHost *:80>
  ServerAdmin mlawson1986@gmail.com
  ServerName <%= node['friends']['site_folder'] %>.local
  Redirect / https://<%= node['friends']['site_folder'] %>.local
</VirtualHost>

<VirtualHost *:443>
  ServerAdmin mlawson1986@gmail.com
  DocumentRoot "<%= node['friends']['vm_doc_root'] %>/<%= node['friends']['site_folder'] %>/public"
  ServerName <%= node['friends']['server_name'] %>
  ErrorLog "/var/log/apache2/<%= node['friends']['site_folder'] %>_error"
  CustomLog "/var/log/apache2/<%= node['friends']['site_folder'] %>_custom" common
  SSLEngine on
  SSLCertificateFile <%= node['selfsigned_certificate']['destination'] %>/<%= node['friends']['server_name'] %>.crt
  SSLCertificateKeyFile <%= node['selfsigned_certificate']['destination'] %>/<%= node['friends']['server_name'] %>.key
  <Directory <%= node['friends']['vm_doc_root'] %>/<%= node['friends']['site_folder'] %>/public >
    AllowOverride All
    Require all granted
  </Directory>
</VirtualHost>
